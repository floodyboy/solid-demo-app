System.register([],(function(t,e){"use strict";return{execute:function(){function e(t,e){if(!t)throw new Error(e||"Assertion failed")}function r(t,e,r=!1){const s=(255&t)/255*e,n=Math.trunc((t>>>24)*s),i=Math.trunc((t>>>16&255)*s),a=Math.trunc((t>>>8&255)*s),o=Math.trunc(255*s);return r?(o<<24|a<<16|i<<8|n)>>>0:(n<<24|i<<16|a<<8|o)>>>0}function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t({a:e,f:function(t,e){const r={x1:Math.max(t.x1,e.x1),y1:Math.max(t.y1,e.y1),x2:Math.min(t.x2,e.x2),y2:Math.min(t.y2,e.y2)};return r.x1<r.x2&&r.y1<r.y2?r:{x1:0,y1:0,x2:0,y2:0}},i:function(t){return t.x1<t.x2&&t.y1<t.y2},j:function(t,e){const r=t>>>24,s=t>>>16&255,n=t>>>8&255,i=Math.trunc((255&t)*e);return(r<<24|s<<16|n<<8|i)>>>0},k:function(t){const e=Math.floor(255*t[0]),r=Math.floor(255*t[1]),s=Math.floor(255*t[2]),n=Math.floor(255*t[3]);return`rgba(${e},${r},${s},${n.toFixed(4)})`},l:function(t,e){const r=Math.max(t.x,e.x),s=Math.max(t.y,e.y),n=Math.min(t.x+t.width,e.x+e.width)-r,i=Math.min(t.y+t.height,e.y+e.height)-s;return n>0&&i>0?{x:r,y:s,width:n,height:i}:{x:0,y:0,width:0,height:0}},m:function(t,e,r){const s=Math.trunc(t>>>24),n=Math.trunc(t>>>16&255),i=Math.trunc(t>>>8&255),a=Math.trunc(255&t),o=Math.trunc(e>>>24),h=Math.trunc(e>>>16&255),u=Math.trunc(e>>>8&255),c=Math.trunc(255&e),d=Math.round(o*r+s*(1-r)),l=Math.round(h*r+n*(1-r)),f=Math.round(u*r+i*(1-r)),x=Math.round(c*r+a*(1-r));return(d<<24|l<<16|f<<8|x)>>>0}});const n=t=>t&&!(t&t-1),i=(t,e,r,s)=>{const n=3*t,i=3*(r-t)-n,a=1-n-i,o=3*e,h=3*(s-e)-o,u=1-o-h;return function(t){if(t>=1)return 1;if(t<=0)return 0;let e,r,s,c=.5;for(let f=0;f<20;f++){if(e=c*(c*(c*a+i)+n),s=t-e,s>-1e-8&&s<1e-8)return c*(c*(c*u+h)+o);if(r=c*(c*(3*a)+2*i)+n,r>1e-10&&r<1e-10)break;c+=s/r}let d=0,l=1;for(let f=0;f<20;f++){if(c=.5*(d+l),e=c*(c*(c*a+i)+n),s=t-e,s>-1e-8&&s<1e-8)return c*(c*(c*u+h)+o);s<0?l=c:d=c}}};t("g",(t=>{switch(t){case"linear":return function(t){return t};case"ease":return i(.25,.1,.25,1);case"ease-in":return i(.42,0,1,1);case"ease-out":return i(0,0,.58,1);case"ease-in-out":return i(.42,0,.58,1);case"ease-in-sine":case"ease-out-sine":return i(.12,0,.39,0);case"ease-in-out-sine":return i(.37,0,.63,1);case"ease-in-cubic":return i(.32,0,.67,0);case"ease-out-cubic":return i(.33,1,.68,1);case"ease-in-out-cubic":return i(.65,0,.35,1);case"ease-in-circ":return i(.55,0,1,.45);case"ease-out-circ":return i(0,.55,.45,1);case"ease-in-out-circ":return i(.85,0,.15,1);case"ease-in-back":return i(.36,0,.66,-.56);case"ease-out-back":return i(.34,1.56,.64,1);case"ease-in-out-back":return i(.68,-.6,.32,1.6);case"step-start":return function(){return 1};case"step-end":return function(t){return 1===t?1:0};default:const e="cubic-bezier(";if(t&&0===t.indexOf(e)){const r=t.substr(e.length,t.length-e.length-1).split(",");if(4!==r.length)return console.warn("Unknown timing function: "+t),function(t){return t};const s=parseFloat(r[0]||"0.42"),n=parseFloat(r[1]||"0"),a=parseFloat(r[2]||"1"),o=parseFloat(r[3]||"1");return isNaN(s)||isNaN(n)||isNaN(a)||isNaN(o)?(console.warn(" Unknown timing function: "+t),function(t){return t}):i(s,n,a,o)}return console.warn("Unknown timing function: "+t),function(t){return t}}})),Math.hypot||(Math.hypot=(...t)=>{let e=0,r=t.length;for(;r--;)e+=t[r]*t[r];return Math.sqrt(e)});class a{eventListeners={};on(t,e){let r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){const r=this.eventListeners[t];if(!r)return;if(!e)return void delete this.eventListeners[t];const s=r.indexOf(e);s>=0&&r.splice(s,1)}once(t,e){const r=(s,n)=>{this.off(t,r),e(s,n)};this.on(t,r)}emit(t,e){const r=this.eventListeners[t];r&&[...r].forEach((t=>{t(this,e)}))}removeAllListeners(){this.eventListeners={}}}t("E",a);class o{textureSource;constructor(t){this.textureSource=t}}class h{stage;constructor(t){this.stage=t}}class u{}class c{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function d(t,e,r){const s=t.createShader(e);if(!s)throw new Error;if(t.shaderSource(s,r),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;console.log(t.getShaderInfoLog(s)),t.deleteShader(s)}function l(t){return self.WebGL2RenderingContext&&t instanceof self.WebGL2RenderingContext}class f extends c{boundBufferCollection=null;buffersBound=!1;program;vao;renderer;gl;attributeBuffers;attributeLocations;attributeNames;uniformLocations;uniformTypes;supportsIndexedTextures;constructor(t){super();const e=this.renderer=t.renderer,r=this.gl=this.renderer.gl;this.supportsIndexedTextures=t.supportsIndexedTextures||!1;const s=l(r),n=s&&t.webgl2Extensions||!s&&t.webgl1Extensions||[],i=s?"2.0":"1.0";n.forEach((t=>{if(!r.getExtension(t))throw new Error(`Shader "${this.constructor.name}" requires extension "${t}" for WebGL ${i} but wasn't found`)}));const a=t.shaderSources||this.constructor.shaderSources;if(!a)throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);s&&a?.webGl2&&(a.fragment=a.webGl2.fragment,a.vertex=a.webGl2.vertex,delete a.webGl2);const o=e.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,h=a.vertex instanceof Function?a.vertex(o):a.vertex,u=a.fragment instanceof Function?a.fragment(o):a.fragment,c=d(r,r.VERTEX_SHADER,h),f=d(r,r.FRAGMENT_SHADER,u);if(!c||!f)throw new Error;const x=function(t,e,r){const s=t.createProgram();if(!s)throw new Error;if(t.attachShader(s,e),t.attachShader(s,r),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS))return s;console.log(t.getProgramInfoLog(s)),t.deleteProgram(s)}(r,c,f);if(!x)throw new Error;if(this.program=x,s){const t=r.createVertexArray();if(!t)throw new Error;this.vao=t,r.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...t.attributes].forEach((t=>{const e=r.getAttribLocation(this.program,t);if(e<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${t}"!`);const s=r.createBuffer();if(!s)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${t}"`);this.attributeLocations[t]=e,this.attributeBuffers[t]=s,this.attributeNames.push(t)})),this.uniformLocations={},this.uniformTypes={},t.uniforms.forEach((t=>{const e=r.getUniformLocation(this.program,t.name);this.uniformTypes[t.name]=t.uniform,e?this.uniformLocations[t.name]=e:console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${t.name}"`)}))}bindBufferAttribute(t,e,r){const s=this.gl;s.enableVertexAttribArray(t),s.bindBuffer(s.ARRAY_BUFFER,e),s.vertexAttribPointer(t,r.size,r.type,r.normalized,r.stride,r.offset)}disableAttribute(t){this.gl.disableVertexAttribArray(t)}disableAttributes(){for(const t in this.attributeLocations)this.disableAttribute(this.attributeLocations[t]);this.boundBufferCollection=null}canBatchShaderProps(t,e){return!1}bindRenderOp(t,e){this.bindBufferCollection(t.buffers),t.textures.length>0&&this.bindTextures(t.textures);const{gl:r}=t;if(this.setUniform("u_resolution",[r.canvas.width,r.canvas.height]),this.setUniform("u_pixelRatio",t.options.pixelRatio),e){if(s(e,"$dimensions")){let r=e.$dimensions;r||(r=t.dimensions),this.setUniform("u_dimensions",[r.width,r.height])}if(s(e,"$alpha")){let r=e.$alpha;r||(r=t.alpha),this.setUniform("u_alpha",r)}this.bindProps(e)}}setUniform(t,e){this.gl[this.uniformTypes[t]](this.uniformLocations[t],e)}bindBufferCollection(t){if(this.boundBufferCollection!==t){for(const r in this.attributeLocations){const s=t.getBuffer(r),n=t.getAttributeInfo(r);e(s,`Buffer for "${r}" not found`),e(n),this.bindBufferAttribute(this.attributeLocations[r],s,n)}this.boundBufferCollection=t}}bindProps(t){}bindTextures(t){}attach(){this.gl.useProgram(this.program),l(this.gl)&&this.vao&&this.gl.bindVertexArray(this.vao)}detach(){this.disableAttributes()}static shaderSources}t("b",f);class x extends u{gl;options;buffers;shader;shaderProps;alpha;clippingRect;dimensions;bufferIdx;zIndex;length=0;numQuads=0;textures=[];maxTextures;constructor(t,e,r,s,n,i,a,o,h,u){super(),this.gl=t,this.options=e,this.buffers=r,this.shader=s,this.shaderProps=n,this.alpha=i,this.clippingRect=a,this.dimensions=o,this.bufferIdx=h,this.zIndex=u,this.gl=t,this.maxTextures=s.supportsIndexedTextures?t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(t){const{textures:e,maxTextures:r}=this,s=e.findIndex((e=>e===t));if(-1!==s)return s;const n=e.length;return n>=r?4294967295:(this.textures.push(t),n)}draw(){const{gl:t,shader:e,shaderProps:r,options:s}=this,{shManager:n}=s;n.useShader(e),e.bindRenderOp(this,r);const i=this.bufferIdx/24*6*2;if(t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.clippingRect){const{x:e,y:r,width:n,height:i}=this.clippingRect,a=s.pixelRatio,o=s.canvas.height,h=Math.round(e*a),u=Math.round(n*a),c=Math.round(i*a),d=Math.round(o-c-r*a);t.enable(t.SCISSOR_TEST),t.scissor(h,d,u,c)}else t.disable(t.SCISSOR_TEST);t.drawElements(t.TRIANGLES,6*this.numQuads,t.UNSIGNED_SHORT,i)}}function p(t){const e={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(e).forEach((r=>{e[r]=t.getParameter(t[r])})),e}function g(t){const e={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(e).forEach((r=>{e[r]=t.getExtension(r)})),e}t("h",x);const E=new Uint8Array([0,0,0,0]);class _ extends o{gl;_nativeCtxTexture=null;_state="freed";_w=0;_h=0;constructor(t,e){super(e),this.gl=t}get ctxTexture(){return"freed"===this._state&&this.load(),e(this._nativeCtxTexture),this._nativeCtxTexture}get w(){return this._w}get h(){return this._h}load(){"loading"!==this._state&&"loaded"!==this._state&&(this._state="loading",this.textureSource.setState("loading"),this.onLoadRequest().then((({width:t,height:e})=>{this._state="loaded",this._w=t,this._h=e,this.textureSource.setState("loaded",{width:t,height:e})})).catch((t=>{this._state="failed",this.textureSource.setState("failed",t),console.error(t)})))}async onLoadRequest(){this._nativeCtxTexture=this.createNativeCtxTexture();const{gl:t}=this;t.bindTexture(t.TEXTURE_2D,this._nativeCtxTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,this._nativeCtxTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,E);const r=await(this.textureSource?.getTextureData());let s=0,i=0;if(e(this._nativeCtxTexture),r.data instanceof ImageBitmap||r.data instanceof ImageData){const e=r.data;s=e.width,i=e.height,t.bindTexture(t.TEXTURE_2D,this._nativeCtxTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!r.premultiplyAlpha),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),(l(t)||n(s)&&n(i))&&t.generateMipmap(t.TEXTURE_2D)}else null===r.data?(s=0,i=0,t.bindTexture(t.TEXTURE_2D,this._nativeCtxTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,E)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",r);return{width:s,height:i}}free(){"freed"!==this._state&&(this._state="freed",this._w=0,this._h=0,this._nativeCtxTexture&&(this.gl.deleteTexture(this._nativeCtxTexture),this._nativeCtxTexture=null))}createNativeCtxTexture(){const t=this.gl.createTexture();if(!t)throw new Error("Could not create WebGL Texture");return t}}class T extends a{txManager;dimensions=null;error=null;state="loading";constructor(t){super(),this.txManager=t}setState(t,...e){if(this.state!==t){if(this.state=t,"loaded"===t){const t=e;this.dimensions=t[0]}else if("failed"===t){const t=e;this.error=t[0]}this.emit(t,...e)}}static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}t("T",T);class m extends T{props;constructor(t,e){super(t),this.props=m.resolveDefaults(e||{})}get color(){return this.props.color}set color(t){this.props.color=t}async getTextureData(){const t=new Uint32Array([this.color]),e=new Uint8ClampedArray(t.buffer);return{data:new ImageData(e,1,1),premultiplyAlpha:!0}}static makeCacheKey(t){return`ColorTexture,${m.resolveDefaults(t).color}`}static resolveDefaults(t){return{color:t.color||4294967295}}static z$__type__Props}t("d",m);class b extends T{props;parentTexture;constructor(t,e){super(t),this.parentTexture=this.txManager.loadTexture(e.texture.txType,e.texture.props,e.texture.options),this.props=b.resolveDefaults(e||{}),queueMicrotask((()=>{const t=this.parentTexture;"loaded"===t.state?this.onParentTxLoaded(t,t.dimensions):"failed"===t.state&&this.onParentTxFailed(t,t.error),t.on("loaded",this.onParentTxLoaded),t.on("failed",this.onParentTxFailed)}))}onParentTxLoaded=()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})};onParentTxFailed=(t,e)=>{this.setState("failed",e)};async getTextureData(){return{data:this.props}}static makeCacheKey(t){return!1}static resolveDefaults(t){return{texture:t.texture,x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0}}static z$__type__Props}t("e",b);class w extends _{constructor(t,e){super(t,e)}async onLoadRequest(){const t=await this.textureSource.getTextureData();return{width:t.data?.width||0,height:t.data?.height||0}}}const R=t("c",(t=>[(t>>>24)/255,(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255]));class y{config;constructor(t){this.config=t}getBuffer(t){return this.config.find((e=>e.attributes[t]))?.buffer}getAttributeInfo(t){return this.config.find((e=>e.attributes[t]))?.attributes[t]}}t("B",y);class A extends h{gl;system;txManager;shManager;options;quadBuffer=new ArrayBuffer(4194304);fQuadBuffer=new Float32Array(this.quadBuffer);uiQuadBuffer=new Uint32Array(this.quadBuffer);renderOps=[];curBufferIdx=0;curRenderOp=null;renderables=[];defaultShader;quadBufferCollection;defaultTexture;constructor(t){super(t.stage);const{canvas:r,clearColor:s,bufferMemory:n}=t;this.options=t,this.txManager=t.txManager,this.shManager=t.shManager,this.defaultTexture=new m(this.txManager);const i=function(t){const e={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1};return t.getContext("webgl",e)||t.getContext("experimental-webgl",e)}(r);if(!i)throw new Error("Unable to create WebGL context");this.gl=i;const a=R(s);i.viewport(0,0,r.width,r.height),i.clearColor(a[0],a[1],a[2],a[3]),function(t,e){if(!t)throw new Error("No WebGL context");const r=~~(e/80),s=new Uint16Array(6*r);for(let i=0,a=0;i<r;i+=6,a+=4)s[i]=a,s[i+1]=a+1,s[i+2]=a+2,s[i+3]=a+2,s[i+4]=a+1,s[i+5]=a+3;const n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW)}(i,n),this.system={parameters:p(i),extensions:g(i)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShaderBatched").shader;const o=i.createBuffer();e(o);const h=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new y([{buffer:o,attributes:{a_position:{name:"a_position",size:2,type:i.FLOAT,normalized:!1,stride:h,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:i.FLOAT,normalized:!1,stride:h,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:i.UNSIGNED_BYTE,normalized:!0,stride:h,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:i.FLOAT,normalized:!1,stride:h,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,this.gl.clear(this.gl.COLOR_BUFFER_BIT)}getShaderManager(){return this.shManager}createCtxTexture(t){return t instanceof b?new w(this.gl,t):new _(this.gl,t)}addRenderable(t){this.renderables?.push(t)}addQuad(t){const{fQuadBuffer:n,uiQuadBuffer:i}=this,{width:a,height:o,clippingRect:h,colorTl:u,colorTr:c,colorBl:d,colorBr:l,textureOptions:x,shader:p,shaderProps:g,alpha:E,wpx:m,wpy:w,ta:R,tb:y,tc:A,td:M}=t;let{texture:S}=t;if(g&&s(g,"$dimensions")){const t=g.$dimensions;t.width=a,t.height=o}S=S??this.defaultTexture,e(S instanceof T,"Invalid texture type");let{curBufferIdx:B,curRenderOp:I}=this;const L={width:a,height:o},v=p||this.defaultShader;var U,C;e(v instanceof f),I&&(I.shader===v&&((U=I.clippingRect)===(C=h)||null!==U&&null!==C&&U.x===C.x&&U.y===C.y&&U.width===C.width&&U.height===C.height)&&(I.shader===this.defaultShader||g&&I.shader.canBatchShaderProps(I.shaderProps,g))||(I=null)),e(v instanceof f),I||(this.newRenderOp(v,g,E,L,h,B),I=this.curRenderOp,e(I));const N=x?.flipX??!1,F=x?.flipY??!1;let D=0,P=0,O=1,G=1;if(S instanceof b){const{x:t,y:e,width:r,height:s}=S.props,{width:n=0,height:i=0}=S.parentTexture.dimensions||{width:0,height:0};D=t/n,O=D+r/n,P=e/i,G=P+s/i,S=S.parentTexture}N&&([D,O]=[O,D]),F&&([P,G]=[G,P]);const{txManager:X}=this.stage,$=X.getCtxTexture(S);e($ instanceof _);const k=this.addTexture($,B);if(I=this.curRenderOp,e(I),0!==y||0!==A)n[B++]=m,n[B++]=w,n[B++]=D,n[B++]=P,i[B++]=r(u,E,!0),n[B++]=k,n[B++]=m+a*R,n[B++]=w+a*A,n[B++]=O,n[B++]=P,i[B++]=r(c,E,!0),n[B++]=k,n[B++]=m+o*y,n[B++]=w+o*M,n[B++]=D,n[B++]=G,i[B++]=r(d,E,!0),n[B++]=k,n[B++]=m+a*R+o*y,n[B++]=w+a*A+o*M,n[B++]=O,n[B++]=G,i[B++]=r(l,E,!0),n[B++]=k;else{const t=m+a*R,e=w+o*M;n[B++]=m,n[B++]=w,n[B++]=D,n[B++]=P,i[B++]=r(u,E,!0),n[B++]=k,n[B++]=t,n[B++]=w,n[B++]=O,n[B++]=P,i[B++]=r(c,E,!0),n[B++]=k,n[B++]=m,n[B++]=e,n[B++]=D,n[B++]=G,i[B++]=r(d,E,!0),n[B++]=k,n[B++]=t,n[B++]=e,n[B++]=O,n[B++]=G,i[B++]=r(l,E,!0),n[B++]=k}I.length+=24,I.numQuads++,this.curBufferIdx=B}newRenderOp(t,e,r,s,n,i){const a=new x(this.gl,this.options,this.quadBufferCollection,t,e,r,n,s,i,0);this.curRenderOp=a,this.renderOps.push(a)}addTexture(t,r,s){const{curRenderOp:n}=this;e(n);const i=n.addTexture(t);if(4294967295===i){if(s)throw new Error("Unable to add texture to render op");const{shader:e,shaderProps:i,dimensions:a,clippingRect:o,alpha:h}=n;return this.newRenderOp(e,i,h,a,o,r),this.addTexture(t,r,!0)}return i}sortRenderables(){const{renderables:t}=this;t.sort(((t,e)=>t.zIndex-e.zIndex)),t.forEach((t=>{t instanceof x?(this.renderOps.push(t),this.curRenderOp=null):this.addQuad(t)}))}render(t="screen"){const{gl:e,quadBuffer:r}=this,s=new Float32Array(r,0,this.curBufferIdx),n=this.quadBufferCollection.getBuffer("a_position")??null;e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,s,e.DYNAMIC_DRAW),this.renderOps.forEach(((t,e)=>{t.draw()})),this.renderables=[]}}t("n",A);class M extends a{fontFamily;descriptors;loaded=!1;constructor(t,e){super(),this.fontFamily=t,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...e}}static convertToCssFontFaceDescriptors(t){return{style:t.style,weight:"number"==typeof t.weight?`${t.weight}`:t.weight,stretch:t.stretch,unicodeRange:t.unicodeRange,variant:t.variant,featureSettings:t.featureSettings,display:t.display}}}const S=10;class B{}class I extends B{data;kernings;constructor(t){super(),this.data=t;const e=this.kernings={};t.kernings.forEach((t=>{const r=t.second;(e[r]=e[r]||{})[t.first]=t.amount})),this.kernings=e}*shapeText(t,e){let r,s;for(;(r=e.peek())&&!r.done;){const n=r.value,i=this.data.chars.find((t=>t.id===n));if(e.next(),void 0!==i){const r=void 0!==s?(this.kernings[i.id]?.[s]||0)+t.letterSpacing:0;s=i.id,yield{mapped:!0,glyphId:i.id,codepoint:n,cluster:e.lastIndex,xAdvance:i.xadvance+r,yAdvance:0,xOffset:i.xoffset+r,yOffset:i.yoffset,xBearing:0,yBearing:0,width:i.width,height:i.height}}else n===S&&(s=void 0),yield{mapped:!1,codepoint:n,cluster:e.lastIndex}}}}t("S",class extends M{type;texture;data;shaper;glyphMap=new Map;constructor(t,r,s,n,i,a){super(t,r),this.type=s,e(n.renderer instanceof A,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=n.txManager.loadTexture("ImageTexture",{src:i,premultiplyAlpha:!1},{preload:!0}),fetch(a).then((async t=>{this.data=await t.json(),this.shaper=new I(this.data),this.data.chars.forEach((t=>{this.glyphMap.set(t.id,t)})),this.checkLoaded()})).catch(console.error)}getAtlasEntry(t){const e=this.glyphMap.get(t);if(void 0===e)throw new Error(`Glyph ${t} not found in font ${this.fontFamily}`);return{x:e.x,y:e.y,width:e.width,height:e.height}}checkLoaded(){this.loaded||this.data&&(this.loaded=!0,this.emit("loaded"))}}),t("W",class extends M{fontFace;fontUrl;constructor(t,e,r){super(t,e);const s=r.replace(/\(|\)/g,""),n=this.descriptors,i={style:n.style,weight:"number"==typeof n.weight?`${n.weight}`:n.weight,stretch:n.stretch,unicodeRange:n.unicodeRange,variant:n.variant,featureSettings:n.featureSettings,display:n.display},a=new FontFace(t,`url(${s})`,i);a.load().then((()=>{this.loaded=!0,this.emit("loaded")})).catch(console.error),this.fontFace=a,this.fontUrl=r}}),t("C",class{})}}}));
//# sourceMappingURL=CoreExtension-legacy-ac715ad4.js.map
