System.register(["./TextNodeStruct-legacy-4e399b28.js","./CoreExtension-legacy-ac715ad4.js"],(function(t,e){"use strict";var o,n,r,i,l,c,a,s,d,h,p,u;return{setters:[t=>{o=t.d,n=t.T,r=t.a,i=t.b,l=t.C,c=t.c,a=t.B,s=t.N,d=t.e,h=t.S,p=t.l},t=>{u=t.a}],execute:function(){class t extends o{stage;coreNode;_parent=null;_children=[];texture=null;animationControllers=new Map;constructor(e,o,l,c){super(o,c),this.stage=e,this.coreNode=new Proxy(l||this.createCoreNode(e,o),{set:(t,e,o)=>("parent"!==e&&"texture"!==e&&"shader"!==e&&Reflect.set(this,e,o),Reflect.set(t,e,o))});const a=n.instance.getSharedObjectById(o.parentId);u(a instanceof t||null===a),this.parent=a,this.on("createAnimation",((t,{id:e,props:o,settings:n})=>{const l=new r(this.coreNode,o,n);l.on("finished",(()=>{this.emit("animationFinished",{id:e,loop:n.loop})}));const c=new i(this.stage.animationManager,l);this.animationControllers.set(e,c)})),this.on("destroyAnimation",((t,{id:e})=>{this.animationControllers.delete(e)})),this.on("startAnimation",((t,{id:e})=>{this.animationControllers.get(e)?.start()})),this.on("stopAnimation",((t,{id:e})=>{this.animationControllers.get(e)?.stop()})),this.on("pauseAnimation",((t,{id:e})=>{this.animationControllers.get(e)?.pause()})),this.on("loadTexture",((t,e)=>{this.coreNode.loadTexture(e.txType,e.props,e.options)})),this.on("loadShader",((t,e)=>{this.coreNode.loadShader(e.shType,e.props)})),this.on("unloadTexture",(t=>{this.coreNode.unloadTexture()})),this.coreNode.on("txLoaded",((t,e)=>{this.emit("txLoaded",e)})),this.coreNode.on("txFailed",((t,e)=>{this.emit("txFailed",e)}))}onPropertyChange(e,o,r){if("parentId"===e){const e=n.instance.getSharedObjectById(o);return u(e instanceof t||null===e),void(this.parent=e)}this.coreNode[e]=o}get parent(){return this._parent}set parent(t){const e=this._parent;if(this._parent=t,this.coreNode.parent=t?.coreNode??null,this.parentId=t?.id??0,e){const t=e.children.indexOf(this);u(-1!==t,"ThreadXRendererNode.parent: Node not found in old parent's children!"),e.children.splice(t,1)}t&&t.children.push(this)}get children(){return this._children}createCoreNode(e,o){const r=n.instance.getSharedObjectById(o.parentId);return u(r instanceof t||null===r),new l(e,{id:o.id,x:o.x,y:o.y,width:o.width,height:o.height,alpha:o.alpha,clipping:o.clipping,color:o.color,colorTop:o.colorTop,colorBottom:o.colorBottom,colorLeft:o.colorLeft,colorRight:o.colorRight,colorTl:o.colorTl,colorTr:o.colorTr,colorBl:o.colorBl,colorBr:o.colorBr,zIndex:o.zIndex,zIndexLocked:o.zIndexLocked,scale:o.scale,mount:o.mount,mountX:o.mountX,mountY:o.mountY,pivot:o.pivot,pivotX:o.pivotX,pivotY:o.pivotY,rotation:o.rotation,shader:null,shaderProps:null,texture:null,textureOptions:null,parent:null})}}function e(t,e){return"object"==typeof e&&null!==e&&"type"in e&&e.type===t}class x extends t{constructor(t,e){super(t,e,new c(t,{id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,alpha:e.alpha,clipping:e.clipping,color:e.color,colorTop:e.colorTop,colorBottom:e.colorBottom,colorLeft:e.colorLeft,colorRight:e.colorRight,colorTl:e.colorTl,colorTr:e.colorTr,colorBl:e.colorBl,colorBr:e.colorBr,zIndex:e.zIndex,zIndexLocked:e.zIndexLocked,mount:e.mount,mountX:e.mountX,mountY:e.mountY,pivot:e.pivot,pivotX:e.pivotX,pivotY:e.pivotY,scale:e.scale,rotation:e.rotation,shader:null,shaderProps:null,texture:null,textureOptions:null,parent:null,text:e.text,textRendererOverride:e.textRendererOverride,fontSize:e.fontSize,fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontStretch:e.fontStretch,fontStyle:e.fontStyle,contain:e.contain,letterSpacing:e.letterSpacing,offsetY:e.offsetY,textAlign:e.textAlign,scrollable:e.scrollable,scrollY:e.scrollY,debug:{}}),{text:e.text,textRendererOverride:e.textRendererOverride,fontSize:e.fontSize,fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontStretch:e.fontStretch,fontStyle:e.fontStyle,contain:e.contain,letterSpacing:e.letterSpacing,offsetY:e.offsetY,textAlign:e.textAlign,scrollable:e.scrollable,scrollY:e.scrollY}),this.coreNode.on("textLoaded",((t,e)=>{this.emit("textLoaded",e)})),this.coreNode.on("textFailed",((t,e)=>{this.emit("textFailed",e)})),this.on("debug",((t,e)=>{this.coreNode.debug=e}))}}let g=null,f=null,m=null;const y=n.init({workerId:2,workerName:"renderer",sharedObjectFactory(e){const o=a.extractTypeId(e);if(o===s.typeId){const o=new s(e);return o.parentId=o.parentId||0,o.lock((()=>(u(f),new t(f,o))))}if(o===d.typeId){const t=new d(e);return t.parentId=t.parentId||0,t.lock((()=>(u(f),new x(f,t))))}return null},async onMessage(o){if(e("init",o)){g=o.canvas;const e=new s;f=new h({rootId:e.id,appWidth:o.appWidth,appHeight:o.appHeight,deviceLogicalPixelRatio:o.deviceLogicalPixelRatio,devicePhysicalPixelRatio:o.devicePhysicalPixelRatio,clearColor:o.clearColor,canvas:g,debug:{monitorTextureCache:!1}});const n=f.root;return Object.assign(e,{x:n.x,y:n.y,width:n.width,height:n.height,alpha:n.alpha,clipping:n.clipping,color:n.color,colorTop:n.colorTop,colorRight:n.colorRight,colorBottom:n.colorBottom,colorLeft:n.colorLeft,colorTl:n.colorTl,colorTr:n.colorTr,colorBr:n.colorBr,colorBl:n.colorBl,parentId:n.parent?.id??0,zIndex:n.zIndex,zIndexLocked:n.zIndexLocked,scale:n.scale,mount:n.mount,mountX:n.mountX,mountY:n.mountY,pivot:n.pivot,pivotX:n.pivotX,pivotY:n.pivotY,rotation:n.rotation}),m=new t(f,e,n),await y.shareObjects("parent",[m]),o.coreExtensionModule&&await p(o.coreExtensionModule,f),m.id}if(e("releaseTexture",o)){u(f);const t=f.txManager;u(t),t.removeTextureIdFromCache(o.textureDescId)}},onObjectShared(t){},onBeforeObjectForgotten(e){e instanceof t&&(e.parent=null,e.destroy())}})}}}));
//# sourceMappingURL=threadx-core-worker-legacy-9826be22.js.map
