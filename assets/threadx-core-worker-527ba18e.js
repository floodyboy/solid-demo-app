var X=Object.defineProperty;var R=(i,e,o)=>e in i?X(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var f=(i,e,o)=>(R(i,typeof e!="symbol"?e+"":e,o),o);import{d as z,T as m,a as b,b as O,C as L,c as A,B as k,N as y,e as v,S as w,l as j}from"./TextNodeStruct-4ac49366.js";import{a as x}from"./CoreExtension-c81fcba3.js";function _(){import.meta.url,import("_").catch(()=>1);async function*i(){}}class s extends z{constructor(o,n,t,p){super(n,p);f(this,"stage");f(this,"coreNode");f(this,"_parent",null);f(this,"_children",[]);f(this,"texture",null);f(this,"animationControllers",new Map);this.stage=o,this.coreNode=new Proxy(t||this.createCoreNode(o,n),{set:(c,l,r)=>(l!=="parent"&&l!=="texture"&&l!=="shader"&&Reflect.set(this,l,r),Reflect.set(c,l,r))});const g=m.instance.getSharedObjectById(n.parentId);x(g instanceof s||g===null),this.parent=g,this.on("createAnimation",(c,{id:l,props:r,settings:h})=>{const I=new b(this.coreNode,r,h);I.on("finished",()=>{this.emit("animationFinished",{id:l,loop:h.loop})});const C=new O(this.stage.animationManager,I);this.animationControllers.set(l,C)}),this.on("destroyAnimation",(c,{id:l})=>{this.animationControllers.delete(l)}),this.on("startAnimation",(c,{id:l})=>{var r;(r=this.animationControllers.get(l))==null||r.start()}),this.on("stopAnimation",(c,{id:l})=>{var r;(r=this.animationControllers.get(l))==null||r.stop()}),this.on("pauseAnimation",(c,{id:l})=>{var r;(r=this.animationControllers.get(l))==null||r.pause()}),this.on("loadTexture",(c,l)=>{this.coreNode.loadTexture(l.txType,l.props,l.options)}),this.on("loadShader",(c,l)=>{this.coreNode.loadShader(l.shType,l.props)}),this.on("unloadTexture",c=>{this.coreNode.unloadTexture()}),this.coreNode.on("loaded",(c,l)=>{this.emit("loaded",l)}),this.coreNode.on("failed",(c,l)=>{this.emit("failed",l)})}onPropertyChange(o,n,t){if(o==="parentId"){const p=m.instance.getSharedObjectById(n);x(p instanceof s||p===null),this.parent=p;return}else this.coreNode[o]=n}get parent(){return this._parent}set parent(o){var t,p;const n=this._parent;if(this._parent=o,this.coreNode.parent=(t=o==null?void 0:o.coreNode)!=null?t:null,this.parentId=(p=o==null?void 0:o.id)!=null?p:0,n){const g=n.children.indexOf(this);x(g!==-1,"ThreadXRendererNode.parent: Node not found in old parent's children!"),n.children.splice(g,1)}o&&o.children.push(this)}get children(){return this._children}createCoreNode(o,n){const t=m.instance.getSharedObjectById(n.parentId);return x(t instanceof s||t===null),new L(o,{id:n.id,x:n.x,y:n.y,width:n.width,height:n.height,alpha:n.alpha,clipping:n.clipping,color:n.color,colorTop:n.colorTop,colorBottom:n.colorBottom,colorLeft:n.colorLeft,colorRight:n.colorRight,colorTl:n.colorTl,colorTr:n.colorTr,colorBl:n.colorBl,colorBr:n.colorBr,zIndex:n.zIndex,zIndexLocked:n.zIndexLocked,scaleX:n.scaleX,scaleY:n.scaleY,mount:n.mount,mountX:n.mountX,mountY:n.mountY,pivot:n.pivot,pivotX:n.pivotX,pivotY:n.pivotY,rotation:n.rotation,shader:null,shaderProps:null,texture:null,textureOptions:null,parent:null})}}function Y(i,e){return typeof e=="object"&&e!==null&&"type"in e&&e.type===i}class u extends s{constructor(e,o){super(e,o,new A(e,{id:o.id,x:o.x,y:o.y,width:o.width,height:o.height,alpha:o.alpha,clipping:o.clipping,color:o.color,colorTop:o.colorTop,colorBottom:o.colorBottom,colorLeft:o.colorLeft,colorRight:o.colorRight,colorTl:o.colorTl,colorTr:o.colorTr,colorBl:o.colorBl,colorBr:o.colorBr,zIndex:o.zIndex,zIndexLocked:o.zIndexLocked,mount:o.mount,mountX:o.mountX,mountY:o.mountY,pivot:o.pivot,pivotX:o.pivotX,pivotY:o.pivotY,scaleX:o.scaleX,scaleY:o.scaleY,rotation:o.rotation,shader:null,shaderProps:null,texture:null,textureOptions:null,parent:null,text:o.text,textRendererOverride:o.textRendererOverride,fontSize:o.fontSize,fontFamily:o.fontFamily,fontWeight:o.fontWeight,fontStretch:o.fontStretch,fontStyle:o.fontStyle,contain:o.contain,letterSpacing:o.letterSpacing,offsetY:o.offsetY,textAlign:o.textAlign,scrollable:o.scrollable,scrollY:o.scrollY,debug:{}}),{text:o.text,textRendererOverride:o.textRendererOverride,fontSize:o.fontSize,fontFamily:o.fontFamily,fontWeight:o.fontWeight,fontStretch:o.fontStretch,fontStyle:o.fontStyle,contain:o.contain,letterSpacing:o.letterSpacing,offsetY:o.offsetY,textAlign:o.textAlign,scrollable:o.scrollable,scrollY:o.scrollY}),this.on("debug",(n,t)=>{this.coreNode.debug=t})}}let B=null,a=null,T=null;const F=m.init({workerId:2,workerName:"renderer",sharedObjectFactory(i){const e=k.extractTypeId(i);if(e===y.typeId){const o=new y(i);return o.parentId=o.parentId||0,o.lock(()=>(x(a),new s(a,o)))}else if(e===v.typeId){const o=new v(i);return o.parentId=o.parentId||0,o.lock(()=>(x(a),new u(a,o)))}return null},async onMessage(i){var e,o;if(Y("init",i)){B=i.canvas;const n=new y;a=new w({rootId:n.id,appWidth:i.appWidth,appHeight:i.appHeight,deviceLogicalPixelRatio:i.deviceLogicalPixelRatio,devicePhysicalPixelRatio:i.devicePhysicalPixelRatio,clearColor:i.clearColor,canvas:B,debug:{monitorTextureCache:!1}});const t=a.root;return Object.assign(n,{x:t.x,y:t.y,width:t.width,height:t.height,alpha:t.alpha,clipping:t.clipping,color:t.color,colorTop:t.colorTop,colorRight:t.colorRight,colorBottom:t.colorBottom,colorLeft:t.colorLeft,colorTl:t.colorTl,colorTr:t.colorTr,colorBr:t.colorBr,colorBl:t.colorBl,parentId:(o=(e=t.parent)==null?void 0:e.id)!=null?o:0,zIndex:t.zIndex,zIndexLocked:t.zIndexLocked,scaleX:t.scaleX,scaleY:t.scaleY,mount:t.mount,mountX:t.mountX,mountY:t.mountY,pivot:t.pivot,pivotX:t.pivotX,pivotY:t.pivotY,rotation:t.rotation}),T=new s(a,n,t),await F.shareObjects("parent",[T]),i.coreExtensionModule&&await j(i.coreExtensionModule,a),T.id}else if(Y("releaseTexture",i)){x(a);const n=a.txManager;x(n),n.removeTextureIdFromCache(i.textureDescId)}},onObjectShared(i){},onBeforeObjectForgotten(i){i instanceof s&&(i.parent=null,i.destroy())}});export{_ as __vite_legacy_guard};
//# sourceMappingURL=threadx-core-worker-527ba18e.js.map
