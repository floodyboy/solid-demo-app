var ue=Object.defineProperty;var he=(r,n,e)=>n in r?ue(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e;var o=(r,n,e)=>(he(r,typeof n!="symbol"?n+"":n,e),e);function fe(r){const n={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1};return r.getContext("webgl",n)||r.getContext("experimental-webgl",n)}function m(r,n){if(!r)throw new Error(n||"Assertion failed")}function Ce(r,n,e){const t=Math.trunc(r>>>24),s=Math.trunc(r>>>16&255),i=Math.trunc(r>>>8&255),a=Math.trunc(r&255),h=Math.trunc(n>>>24),c=Math.trunc(n>>>16&255),l=Math.trunc(n>>>8&255),E=Math.trunc(n&255),d=Math.round(h*e+t*(1-e)),T=Math.round(c*e+s*(1-e)),A=Math.round(l*e+i*(1-e)),x=Math.round(E*e+a*(1-e));return(d<<24|T<<16|A<<8|x)>>>0}function Le(r,n){const e=r>>>24,t=r>>>16&255,s=r>>>8&255,i=Math.trunc((r&255)*n);return(e<<24|t<<16|s<<8|i)>>>0}function M(r,n,e=!1){const t=(r&255)/255*n,s=Math.trunc((r>>>24)*t),i=Math.trunc((r>>>16&255)*t),a=Math.trunc((r>>>8&255)*t),h=Math.trunc(t*255);return e?(h<<24|a<<16|i<<8|s)>>>0:(s<<24|i<<16|a<<8|h)>>>0}function X(r,n){return Object.prototype.hasOwnProperty.call(r,n)}const j=r=>r&&!(r&r-1),g=(r,n,e,t)=>{const s=3*r,i=3*(e-r)-s,a=1-s-i,h=3*n,c=3*(t-n)-h,l=1-h-c;return function(E){if(E>=1)return 1;if(E<=0)return 0;let d=.5,T,A,x;for(let p=0;p<20;p++){if(T=d*(d*(d*a+i)+s),x=E-T,x>-1e-8&&x<1e-8)return d*(d*(d*l+c)+h);if(A=d*(d*(3*a)+2*i)+s,A>1e-10&&A<1e-10)break;d+=x/A}let f=0,_=1;for(let p=0;p<20;p++){if(d=.5*(f+_),T=d*(d*(d*a+i)+s),x=E-T,x>-1e-8&&x<1e-8)return d*(d*(d*l+c)+h);x<0?_=d:f=d}}},Oe=r=>{switch(r){case"linear":return function(e){return e};case"ease":return g(.25,.1,.25,1);case"ease-in":return g(.42,0,1,1);case"ease-out":return g(0,0,.58,1);case"ease-in-out":return g(.42,0,.58,1);case"ease-in-sine":return g(.12,0,.39,0);case"ease-out-sine":return g(.12,0,.39,0);case"ease-in-out-sine":return g(.37,0,.63,1);case"ease-in-cubic":return g(.32,0,.67,0);case"ease-out-cubic":return g(.33,1,.68,1);case"ease-in-out-cubic":return g(.65,0,.35,1);case"ease-in-circ":return g(.55,0,1,.45);case"ease-out-circ":return g(0,.55,.45,1);case"ease-in-out-circ":return g(.85,0,.15,1);case"ease-in-back":return g(.36,0,.66,-.56);case"ease-out-back":return g(.34,1.56,.64,1);case"ease-in-out-back":return g(.68,-.6,.32,1.6);case"step-start":return function(){return 1};case"step-end":return function(e){return e===1?1:0};default:const n="cubic-bezier(";if(r&&r.indexOf(n)===0){const e=r.substr(n.length,r.length-n.length-1).split(",");if(e.length!==4)return console.warn("Unknown timing function: "+r),function(h){return h};const t=parseFloat(e[0]||"0.42"),s=parseFloat(e[1]||"0"),i=parseFloat(e[2]||"1"),a=parseFloat(e[3]||"1");return isNaN(t)||isNaN(s)||isNaN(i)||isNaN(a)?(console.warn(" Unknown timing function: "+r),function(h){return h}):g(t,s,i,a)}else return console.warn("Unknown timing function: "+r),function(e){return e}}};Math.hypot||(Math.hypot=(...r)=>{let n=0,e=r.length;for(;e--;)n+=r[e]*r[e];return Math.sqrt(n)});class te{constructor(){o(this,"eventListeners",{})}on(n,e){let t=this.eventListeners[n];t||(t=[]),t.push(e),this.eventListeners[n]=t}off(n,e){const t=this.eventListeners[n];if(!t)return;if(!e){delete this.eventListeners[n];return}const s=t.indexOf(e);s>=0&&t.splice(s,1)}once(n,e){const t=(s,i)=>{this.off(n,t),e(s,i)};this.on(n,t)}emit(n,e){const t=this.eventListeners[n];t&&[...t].forEach(s=>{s(this,e)})}removeAllListeners(){this.eventListeners={}}}class de{constructor(n){o(this,"textureSource");this.textureSource=n}}class le{constructor(n){o(this,"stage");this.stage=n}}class xe{}class Te{static makeCacheKey(n){return!1}static resolveDefaults(n){return{}}}function Z(r,n,e){const t=r.createShader(n);if(!t)throw new Error;if(r.shaderSource(t,e),r.compileShader(t),r.getShaderParameter(t,r.COMPILE_STATUS))return t;console.log(r.getShaderInfoLog(t)),r.deleteShader(t)}function Ee(r,n,e){const t=r.createProgram();if(!t)throw new Error;if(r.attachShader(t,n),r.attachShader(t,e),r.linkProgram(t),r.getProgramParameter(t,r.LINK_STATUS))return t;console.log(r.getProgramInfoLog(t)),r.deleteProgram(t)}function W(r){return self.WebGL2RenderingContext&&r instanceof self.WebGL2RenderingContext}class H extends Te{constructor(e){super();o(this,"boundBufferCollection",null);o(this,"buffersBound",!1);o(this,"program");o(this,"vao");o(this,"renderer");o(this,"gl");o(this,"attributeBuffers");o(this,"attributeLocations");o(this,"attributeNames");o(this,"uniformLocations");o(this,"uniformTypes");o(this,"supportsIndexedTextures");const t=this.renderer=e.renderer,s=this.gl=this.renderer.gl;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const i=W(s),a=i&&e.webgl2Extensions||!i&&e.webgl1Extensions||[],h=i?"2.0":"1.0";a.forEach(f=>{if(!s.getExtension(f))throw new Error('Shader "'.concat(this.constructor.name,'" requires extension "').concat(f,'" for WebGL ').concat(h," but wasn't found"))});const c=e.shaderSources||this.constructor.shaderSources;if(c)i&&(c!=null&&c.webGl2)&&(c.fragment=c.webGl2.fragment,c.vertex=c.webGl2.vertex,delete c.webGl2);else throw new Error('Shader "'.concat(this.constructor.name,'" is missing shaderSources.'));const l=t.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,E=c.vertex instanceof Function?c.vertex(l):c.vertex,d=c.fragment instanceof Function?c.fragment(l):c.fragment,T=Z(s,s.VERTEX_SHADER,E),A=Z(s,s.FRAGMENT_SHADER,d);if(!T||!A)throw new Error;const x=Ee(s,T,A);if(!x)throw new Error;if(this.program=x,i){const f=s.createVertexArray();if(!f)throw new Error;this.vao=f,s.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(f=>{const _=s.getAttribLocation(this.program,f);if(_<0)throw new Error("".concat(this.constructor.name,': Vertex shader must have an attribute "').concat(f,'"!'));const p=s.createBuffer();if(!p)throw new Error("".concat(this.constructor.name,': Could not create buffer for attribute "').concat(f,'"'));this.attributeLocations[f]=_,this.attributeBuffers[f]=p,this.attributeNames.push(f)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(f=>{const _=s.getUniformLocation(this.program,f.name);if(this.uniformTypes[f.name]=f.uniform,!_){console.warn('Shader "'.concat(this.constructor.name,'" could not get uniform location for "').concat(f.name,'"'));return}this.uniformLocations[f.name]=_})}bindBufferAttribute(e,t,s){const i=this.gl;i.enableVertexAttribArray(e),i.bindBuffer(i.ARRAY_BUFFER,t),i.vertexAttribPointer(e,s.size,s.type,s.normalized,s.stride,s.offset)}disableAttribute(e){this.gl.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,t){return!1}bindRenderOp(e,t){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{gl:s}=e;if(this.setUniform("u_resolution",[s.canvas.width,s.canvas.height]),this.setUniform("u_pixelRatio",e.options.pixelRatio),t){if(X(t,"$dimensions")){let i=t.$dimensions;i||(i=e.dimensions),this.setUniform("u_dimensions",[i.width,i.height])}if(X(t,"$alpha")){let i=t.$alpha;i||(i=e.alpha),this.setUniform("u_alpha",i)}this.bindProps(t)}}setUniform(e,t){this.gl[this.uniformTypes[e]](this.uniformLocations[e],t)}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const t in this.attributeLocations){const s=e.getBuffer(t),i=e.getAttributeInfo(t);m(s,'Buffer for "'.concat(t,'" not found')),m(i),this.bindBufferAttribute(this.attributeLocations[t],s,i)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.gl.useProgram(this.program),W(this.gl)&&this.vao&&this.gl.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}o(H,"shaderSources");class J extends xe{constructor(e,t,s,i,a,h,c,l,E,d){super();o(this,"gl");o(this,"options");o(this,"buffers");o(this,"shader");o(this,"shaderProps");o(this,"alpha");o(this,"clippingRect");o(this,"dimensions");o(this,"bufferIdx");o(this,"zIndex");o(this,"length",0);o(this,"numQuads",0);o(this,"textures",[]);o(this,"maxTextures");this.gl=e,this.options=t,this.buffers=s,this.shader=i,this.shaderProps=a,this.alpha=h,this.clippingRect=c,this.dimensions=l,this.bufferIdx=E,this.zIndex=d,this.gl=e,this.maxTextures=i.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:t,maxTextures:s}=this,i=t.findIndex(h=>h===e);if(i!==-1)return i;const a=t.length;return a>=s?4294967295:(this.textures.push(e),a)}draw(){const{gl:e,shader:t,shaderProps:s,options:i}=this,{shManager:a}=i;a.useShader(t),t.bindRenderOp(this,s);const h=this.bufferIdx/24*6*2;if(e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.clippingRect){const{x:c,y:l,width:E,height:d}=this.clippingRect,T=i.pixelRatio,A=i.canvas.height,x=Math.round(c*T),f=Math.round(E*T),_=Math.round(d*T),p=Math.round(A-_-l*T);e.enable(e.SCISSOR_TEST),e.scissor(x,p,f,_)}else e.disable(e.SCISSOR_TEST);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,h)}}function _e(r){const n={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(n).forEach(t=>{n[t]=r.getParameter(r[t])}),n}function pe(r){const n={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(n).forEach(t=>{n[t]=r.getExtension(t)}),n}function ge(r,n){if(!r)throw new Error("No WebGL context");const e=~~(n/80),t=new Uint16Array(e*6);for(let i=0,a=0;i<e;i+=6,a+=4)t[i]=a,t[i+1]=a+1,t[i+2]=a+2,t[i+3]=a+2,t[i+4]=a+1,t[i+5]=a+3;const s=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}const ee=new Uint8Array([0,0,0,0]);class $ extends de{constructor(e,t){super(t);o(this,"gl");o(this,"_nativeCtxTexture",null);o(this,"_state","freed");o(this,"_w",0);o(this,"_h",0);this.gl=e}get ctxTexture(){return this._state==="freed"&&this.load(),m(this._nativeCtxTexture),this._nativeCtxTexture}get w(){return this._w}get h(){return this._h}load(){this._state==="loading"||this._state==="loaded"||(this._state="loading",this.textureSource.setState("loading"),this.onLoadRequest().then(({width:e,height:t})=>{this._state="loaded",this._w=e,this._h=t,this.textureSource.setState("loaded",{width:e,height:t})}).catch(e=>{this._state="failed",this.textureSource.setState("failed",e),console.error(e)}))}async onLoadRequest(){var a;this._nativeCtxTexture=this.createNativeCtxTexture();const{gl:e}=this;e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ee);const t=await((a=this.textureSource)==null?void 0:a.getTextureData());let s=0,i=0;if(m(this._nativeCtxTexture),t.data instanceof ImageBitmap||t.data instanceof ImageData){const h=t.data;s=h.width,i=h.height,e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!t.premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h),(W(e)||j(s)&&j(i))&&e.generateMipmap(e.TEXTURE_2D)}else t.data===null?(s=0,i=0,e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ee)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",t);return{width:s,height:i}}free(){this._state!=="freed"&&(this._state="freed",this._w=0,this._h=0,this._nativeCtxTexture&&(this.gl.deleteTexture(this._nativeCtxTexture),this._nativeCtxTexture=null))}createNativeCtxTexture(){const e=this.gl.createTexture();if(!e)throw new Error("Could not create WebGL Texture");return e}}class Y extends te{constructor(e){super();o(this,"txManager");o(this,"dimensions",null);o(this,"error",null);o(this,"state","loading");this.txManager=e}setState(e,...t){if(this.state!==e){if(this.state=e,e==="loaded"){const s=t;this.dimensions=s[0]}else if(e==="failed"){const s=t;this.error=s[0]}this.emit(e,...t)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const L=class L extends Y{constructor(e,t){super(e);o(this,"props");this.props=L.resolveDefaults(t||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),t=new Uint8ClampedArray(e.buffer);return{data:new ImageData(t,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){const t=L.resolveDefaults(e);return"ColorTexture,".concat(t.color)}static resolveDefaults(e){return{color:e.color||4294967295}}};o(L,"z$__type__Props");let k=L;const D=class D extends Y{constructor(e,t){super(e);o(this,"props");o(this,"parentTexture");o(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});o(this,"onParentTxFailed",(e,t)=>{this.setState("failed",t)});this.parentTexture=this.txManager.loadTexture(t.texture.txType,t.texture.props,t.texture.options),this.props=D.resolveDefaults(t||{}),queueMicrotask(()=>{const s=this.parentTexture;s.state==="loaded"?this.onParentTxLoaded(s,s.dimensions):s.state==="failed"&&this.onParentTxFailed(s,s.error),s.on("loaded",this.onParentTxLoaded),s.on("failed",this.onParentTxFailed)})}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};o(D,"z$__type__Props");let N=D;class Re extends ${constructor(n,e){super(n,e)}async onLoadRequest(){var e,t;const n=await this.textureSource.getTextureData();return{width:((e=n.data)==null?void 0:e.width)||0,height:((t=n.data)==null?void 0:t.height)||0}}}const Ae=r=>{const n=r>>>24,e=r>>>16&255,t=r>>>8&255,s=r&255;return[n/255,e/255,t/255,s/255]};function Pe(r){const n=Math.floor(r[0]*255),e=Math.floor(r[1]*255),t=Math.floor(r[2]*255),s=Math.floor(r[3]*255);return"rgba(".concat(n,",").concat(e,",").concat(t,",").concat(s.toFixed(4),")")}function Ne(r,n){const e={x1:Math.max(r.x1,n.x1),y1:Math.max(r.y1,n.y1),x2:Math.min(r.x2,n.x2),y2:Math.min(r.y2,n.y2)};return e.x1<e.x2&&e.y1<e.y2?e:{x1:0,y1:0,x2:0,y2:0}}function De(r,n){const e=Math.max(r.x,n.x),t=Math.max(r.y,n.y),s=Math.min(r.x+r.width,n.x+n.width)-e,i=Math.min(r.y+r.height,n.y+n.height)-t;return s>0&&i>0?{x:e,y:t,width:s,height:i}:{x:0,y:0,width:0,height:0}}function me(r,n){return r===n?!0:r===null||n===null?!1:r.x===n.x&&r.y===n.y&&r.width===n.width&&r.height===n.height}function Fe(r){return r.x1<r.x2&&r.y1<r.y2}class Ie{constructor(n){o(this,"config");this.config=n}getBuffer(n){var e;return(e=this.config.find(t=>t.attributes[n]))==null?void 0:e.buffer}getAttributeInfo(n){var e;return(e=this.config.find(t=>t.attributes[n]))==null?void 0:e.attributes[n]}}const we=24;class Se extends le{constructor(e){super(e.stage);o(this,"gl");o(this,"system");o(this,"txManager");o(this,"shManager");o(this,"options");o(this,"quadBuffer",new ArrayBuffer(1024*1024*4));o(this,"fQuadBuffer",new Float32Array(this.quadBuffer));o(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer));o(this,"renderOps",[]);o(this,"curBufferIdx",0);o(this,"curRenderOp",null);o(this,"renderables",[]);o(this,"defaultShader");o(this,"quadBufferCollection");o(this,"defaultTexture");const{canvas:t,clearColor:s,bufferMemory:i}=e;this.options=e,this.txManager=e.txManager,this.shManager=e.shManager,this.defaultTexture=new k(this.txManager);const a=fe(t);if(!a)throw new Error("Unable to create WebGL context");this.gl=a;const h=Ae(s);a.viewport(0,0,t.width,t.height),a.clearColor(h[0],h[1],h[2],h[3]),ge(a,i),this.system={parameters:_e(a),extensions:pe(a)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShaderBatched").shader;const c=a.createBuffer();m(c);const l=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new Ie([{buffer:c,attributes:{a_position:{name:"a_position",size:2,type:a.FLOAT,normalized:!1,stride:l,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:a.FLOAT,normalized:!1,stride:l,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:a.UNSIGNED_BYTE,normalized:!0,stride:l,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:a.FLOAT,normalized:!1,stride:l,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,this.gl.clear(this.gl.COLOR_BUFFER_BIT)}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof N?new Re(this.gl,e):new $(this.gl,e)}addRenderable(e){var t;(t=this.renderables)==null||t.push(e)}addQuad(e){var z,q;const{fQuadBuffer:t,uiQuadBuffer:s}=this,{width:i,height:a,clippingRect:h,colorTl:c,colorTr:l,colorBl:E,colorBr:d,textureOptions:T,shader:A,shaderProps:x,alpha:f,wpx:_,wpy:p,ta:F,tb:G,tc:U,td:v}=e;let{texture:I}=e;if(x&&X(x,"$dimensions")){const C=x.$dimensions;C.width=i,C.height=a}I=I!=null?I:this.defaultTexture,m(I instanceof Y,"Invalid texture type");let{curBufferIdx:u,curRenderOp:R}=this;const se={width:i,height:a},O=A||this.defaultShader;m(O instanceof H),R&&(R.shader!==O||!me(R.clippingRect,h)||R.shader!==this.defaultShader&&(!x||!R.shader.canBatchShaderProps(R.shaderProps,x)))&&(R=null),m(O instanceof H),R||(this.newRenderOp(O,x,f,se,h,u),R=this.curRenderOp,m(R));const ne=(z=T==null?void 0:T.flipX)!=null?z:!1,ie=(q=T==null?void 0:T.flipY)!=null?q:!1;let w=0,S=0,b=1,B=1;if(I instanceof N){const{x:C,y:P,width:oe,height:ce}=I.props,{width:Q=0,height:K=0}=I.parentTexture.dimensions||{width:0,height:0};w=C/Q,b=w+oe/Q,S=P/K,B=S+ce/K,I=I.parentTexture}ne&&([w,b]=[b,w]),ie&&([S,B]=[B,S]);const{txManager:ae}=this.stage,V=ae.getCtxTexture(I);m(V instanceof $);const y=this.addTexture(V,u);if(R=this.curRenderOp,m(R),G!==0||U!==0)t[u++]=_,t[u++]=p,t[u++]=w,t[u++]=S,s[u++]=M(c,f,!0),t[u++]=y,t[u++]=_+i*F,t[u++]=p+i*U,t[u++]=b,t[u++]=S,s[u++]=M(l,f,!0),t[u++]=y,t[u++]=_+a*G,t[u++]=p+a*v,t[u++]=w,t[u++]=B,s[u++]=M(E,f,!0),t[u++]=y,t[u++]=_+i*F+a*G,t[u++]=p+i*U+a*v,t[u++]=b,t[u++]=B,s[u++]=M(d,f,!0),t[u++]=y;else{const C=_+i*F,P=p+a*v;t[u++]=_,t[u++]=p,t[u++]=w,t[u++]=S,s[u++]=M(c,f,!0),t[u++]=y,t[u++]=C,t[u++]=p,t[u++]=b,t[u++]=S,s[u++]=M(l,f,!0),t[u++]=y,t[u++]=_,t[u++]=P,t[u++]=w,t[u++]=B,s[u++]=M(E,f,!0),t[u++]=y,t[u++]=C,t[u++]=P,t[u++]=b,t[u++]=B,s[u++]=M(d,f,!0),t[u++]=y}R.length+=we,R.numQuads++,this.curBufferIdx=u}newRenderOp(e,t,s,i,a,h){const c=new J(this.gl,this.options,this.quadBufferCollection,e,t,s,a,i,h,0);this.curRenderOp=c,this.renderOps.push(c)}addTexture(e,t,s){const{curRenderOp:i}=this;m(i);const a=i.addTexture(e);if(a===4294967295){if(s)throw new Error("Unable to add texture to render op");const{shader:h,shaderProps:c,dimensions:l,clippingRect:E,alpha:d}=i;return this.newRenderOp(h,c,d,l,E,t),this.addTexture(e,t,!0)}return a}sortRenderables(){const{renderables:e}=this;e.sort((t,s)=>t.zIndex-s.zIndex),e.forEach(t=>{t instanceof J?(this.renderOps.push(t),this.curRenderOp=null):this.addQuad(t)})}render(e="screen"){var h;const{gl:t,quadBuffer:s}=this,i=new Float32Array(s,0,this.curBufferIdx),a=(h=this.quadBufferCollection.getBuffer("a_position"))!=null?h:null;t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW),this.renderOps.forEach((c,l)=>{c.draw()}),this.renderables=[]}}class re extends te{constructor(e,t){super();o(this,"fontFamily");o(this,"descriptors");o(this,"loaded",!1);this.fontFamily=e,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...t}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?"".concat(e.weight):e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,variant:e.variant,featureSettings:e.featureSettings,display:e.display}}}const ye={LINE_FEED:10,CARRIAGE_RETURN:13,SPACE:32,TAB:9,ZERO_WIDTH_SPACE:8203,ZERO_WIDTH_NON_JOINER:8204,ZERO_WIDTH_JOINER:8205,LEFT_TO_RIGHT_MARK:8206,RIGHT_TO_LEFT_MARK:8207,LEFT_TO_RIGHT_EMBEDDING:8234,RIGHT_TO_LEFT_EMBEDDING:8235,POP_DIRECTIONAL_FORMATTING:8236,LEFT_TO_RIGHT_OVERRIDE:8237,RIGHT_TO_LEFT_OVERRIDE:8238,LINE_SEPARATOR:8232,PARAGRAPH_SEPARATOR:8233,OBJECT_REPLACEMENT_CHARACTER:65532,REPLACEMENT_CHARACTER:65533,ZERO_WIDTH_NO_BREAK_SPACE:65279,LEFT_TO_RIGHT_ISOLATE:8294,RIGHT_TO_LEFT_ISOLATE:8295,FIRST_STRONG_ISOLATE:8296,POP_DIRECTIONAL_ISOLATE:8297,INHIBIT_SYMMETRIC_SWAPPING:8298,ACTIVATE_SYMMETRIC_SWAPPING:8299,INHIBIT_ARABIC_FORM_SHAPING:8300,ACTIVATE_ARABIC_FORM_SHAPING:8301,NATIONAL_DIGIT_SHAPES:8302,NOMINAL_DIGIT_SHAPES:8303,LEFT_TO_RIGHT_BOUNDARY:8206,RIGHT_TO_LEFT_BOUNDARY:8207};class Me{}class be extends Me{constructor(e){super();o(this,"data");o(this,"kernings");this.data=e;const t=this.kernings={};e.kernings.forEach(s=>{const i=s.second,a=t[i]=t[i]||{};a[s.first]=s.amount}),this.kernings=t}*shapeText(e,t){var a;let s,i;for(;(s=t.peek())&&!s.done;){const h=s.value,c=this.data.chars.find(l=>l.id===h);if(t.next(),c!==void 0){const l=i!==void 0?(((a=this.kernings[c.id])==null?void 0:a[i])||0)+e.letterSpacing:0;i=c.id,yield{mapped:!0,glyphId:c.id,codepoint:h,cluster:t.lastIndex,xAdvance:c.xadvance+l,yAdvance:0,xOffset:c.xoffset+l,yOffset:c.yoffset,xBearing:0,yBearing:0,width:c.width,height:c.height}}else h===ye.LINE_FEED&&(i=void 0),yield{mapped:!1,codepoint:h,cluster:t.lastIndex}}}}class Ge extends re{constructor(e,t,s,i,a,h){super(e,t);o(this,"type");o(this,"texture");o(this,"data");o(this,"shaper");o(this,"glyphMap",new Map);this.type=s;const c=i.renderer;m(c instanceof Se,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=i.txManager.loadTexture("ImageTexture",{src:a,premultiplyAlpha:!1},{preload:!0}),fetch(h).then(async l=>{this.data=await l.json(),this.shaper=new be(this.data),this.data.chars.forEach(E=>{this.glyphMap.set(E.id,E)}),this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const t=this.glyphMap.get(e);if(t===void 0)throw new Error("Glyph ".concat(e," not found in font ").concat(this.fontFamily));return{x:t.x,y:t.y,width:t.width,height:t.height}}checkLoaded(){this.loaded||this.data&&(this.loaded=!0,this.emit("loaded"))}}class Ue extends re{constructor(e,t,s){super(e,t);o(this,"fontFace");o(this,"fontUrl");const i=s.replace(/\(|\)/g,""),a=this.descriptors,h={style:a.style,weight:typeof a.weight=="number"?"".concat(a.weight):a.weight,stretch:a.stretch,unicodeRange:a.unicodeRange,variant:a.variant,featureSettings:a.featureSettings,display:a.display},c=new FontFace(e,"url(".concat(i,")"),h);c.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error),this.fontFace=c,this.fontUrl=s}}class ve{}export{Ie as B,ve as C,te as E,Ge as S,Y as T,Ue as W,m as a,H as b,Ae as c,k as d,N as e,Ne as f,Oe as g,J as h,Fe as i,Le as j,Pe as k,De as l,Ce as m,Se as n};
//# sourceMappingURL=CoreExtension-d763954d.js.map
