var L=Object.defineProperty;var R=(i,e,o)=>e in i?L(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var f=(i,e,o)=>(R(i,typeof e!="symbol"?e+"":e,o),o);import{d as z,T as m,a as b,b as O,C as X,c as F,B as A,N as h,e as v,S as k,l as u}from"./TextNodeStruct-87d01114.js";import{a as x}from"./CoreExtension-d763954d.js";function _(){import.meta.url,import("_").catch(()=>1);async function*i(){}}class s extends z{constructor(o,t,n,p){super(t,p);f(this,"stage");f(this,"coreNode");f(this,"_parent",null);f(this,"_children",[]);f(this,"texture",null);f(this,"animationControllers",new Map);this.stage=o,this.coreNode=new Proxy(n||this.createCoreNode(o,t),{set:(a,l,r)=>(l!=="parent"&&l!=="texture"&&l!=="shader"&&Reflect.set(this,l,r),Reflect.set(a,l,r))});const g=m.instance.getSharedObjectById(t.parentId);x(g instanceof s||g===null),this.parent=g,this.on("createAnimation",(a,{id:l,props:r,settings:T})=>{const I=new b(this.coreNode,r,T);I.on("finished",()=>{this.emit("animationFinished",{id:l,loop:T.loop})});const Y=new O(this.stage.animationManager,I);this.animationControllers.set(l,Y)}),this.on("destroyAnimation",(a,{id:l})=>{this.animationControllers.delete(l)}),this.on("startAnimation",(a,{id:l})=>{var r;(r=this.animationControllers.get(l))==null||r.start()}),this.on("stopAnimation",(a,{id:l})=>{var r;(r=this.animationControllers.get(l))==null||r.stop()}),this.on("pauseAnimation",(a,{id:l})=>{var r;(r=this.animationControllers.get(l))==null||r.pause()}),this.on("loadTexture",(a,l)=>{this.coreNode.loadTexture(l.txType,l.props,l.options)}),this.on("loadShader",(a,l)=>{this.coreNode.loadShader(l.shType,l.props)}),this.on("unloadTexture",a=>{this.coreNode.unloadTexture()}),this.coreNode.on("txLoaded",(a,l)=>{this.emit("txLoaded",l)}),this.coreNode.on("txFailed",(a,l)=>{this.emit("txFailed",l)})}onPropertyChange(o,t,n){if(o==="parentId"){const p=m.instance.getSharedObjectById(t);x(p instanceof s||p===null),this.parent=p;return}else this.coreNode[o]=t}get parent(){return this._parent}set parent(o){var n,p;const t=this._parent;if(this._parent=o,this.coreNode.parent=(n=o==null?void 0:o.coreNode)!=null?n:null,this.parentId=(p=o==null?void 0:o.id)!=null?p:0,t){const g=t.children.indexOf(this);x(g!==-1,"ThreadXRendererNode.parent: Node not found in old parent's children!"),t.children.splice(g,1)}o&&o.children.push(this)}get children(){return this._children}createCoreNode(o,t){const n=m.instance.getSharedObjectById(t.parentId);return x(n instanceof s||n===null),new X(o,{id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,alpha:t.alpha,clipping:t.clipping,color:t.color,colorTop:t.colorTop,colorBottom:t.colorBottom,colorLeft:t.colorLeft,colorRight:t.colorRight,colorTl:t.colorTl,colorTr:t.colorTr,colorBl:t.colorBl,colorBr:t.colorBr,zIndex:t.zIndex,zIndexLocked:t.zIndexLocked,scale:t.scale,mount:t.mount,mountX:t.mountX,mountY:t.mountY,pivot:t.pivot,pivotX:t.pivotX,pivotY:t.pivotY,rotation:t.rotation,shader:null,shaderProps:null,texture:null,textureOptions:null,parent:null})}}function B(i,e){return typeof e=="object"&&e!==null&&"type"in e&&e.type===i}class w extends s{constructor(e,o){super(e,o,new F(e,{id:o.id,x:o.x,y:o.y,width:o.width,height:o.height,alpha:o.alpha,clipping:o.clipping,color:o.color,colorTop:o.colorTop,colorBottom:o.colorBottom,colorLeft:o.colorLeft,colorRight:o.colorRight,colorTl:o.colorTl,colorTr:o.colorTr,colorBl:o.colorBl,colorBr:o.colorBr,zIndex:o.zIndex,zIndexLocked:o.zIndexLocked,mount:o.mount,mountX:o.mountX,mountY:o.mountY,pivot:o.pivot,pivotX:o.pivotX,pivotY:o.pivotY,scale:o.scale,rotation:o.rotation,shader:null,shaderProps:null,texture:null,textureOptions:null,parent:null,text:o.text,textRendererOverride:o.textRendererOverride,fontSize:o.fontSize,fontFamily:o.fontFamily,fontWeight:o.fontWeight,fontStretch:o.fontStretch,fontStyle:o.fontStyle,contain:o.contain,letterSpacing:o.letterSpacing,offsetY:o.offsetY,textAlign:o.textAlign,scrollable:o.scrollable,scrollY:o.scrollY,debug:{}}),{text:o.text,textRendererOverride:o.textRendererOverride,fontSize:o.fontSize,fontFamily:o.fontFamily,fontWeight:o.fontWeight,fontStretch:o.fontStretch,fontStyle:o.fontStyle,contain:o.contain,letterSpacing:o.letterSpacing,offsetY:o.offsetY,textAlign:o.textAlign,scrollable:o.scrollable,scrollY:o.scrollY}),this.coreNode.on("textLoaded",(t,n)=>{this.emit("textLoaded",n)}),this.coreNode.on("textFailed",(t,n)=>{this.emit("textFailed",n)}),this.on("debug",(t,n)=>{this.coreNode.debug=n})}}let C=null,c=null,y=null;const j=m.init({workerId:2,workerName:"renderer",sharedObjectFactory(i){const e=A.extractTypeId(i);if(e===h.typeId){const o=new h(i);return o.parentId=o.parentId||0,o.lock(()=>(x(c),new s(c,o)))}else if(e===v.typeId){const o=new v(i);return o.parentId=o.parentId||0,o.lock(()=>(x(c),new w(c,o)))}return null},async onMessage(i){var e,o;if(B("init",i)){C=i.canvas;const t=new h;c=new k({rootId:t.id,appWidth:i.appWidth,appHeight:i.appHeight,deviceLogicalPixelRatio:i.deviceLogicalPixelRatio,devicePhysicalPixelRatio:i.devicePhysicalPixelRatio,clearColor:i.clearColor,canvas:C,debug:{monitorTextureCache:!1}});const n=c.root;return Object.assign(t,{x:n.x,y:n.y,width:n.width,height:n.height,alpha:n.alpha,clipping:n.clipping,color:n.color,colorTop:n.colorTop,colorRight:n.colorRight,colorBottom:n.colorBottom,colorLeft:n.colorLeft,colorTl:n.colorTl,colorTr:n.colorTr,colorBr:n.colorBr,colorBl:n.colorBl,parentId:(o=(e=n.parent)==null?void 0:e.id)!=null?o:0,zIndex:n.zIndex,zIndexLocked:n.zIndexLocked,scale:n.scale,mount:n.mount,mountX:n.mountX,mountY:n.mountY,pivot:n.pivot,pivotX:n.pivotX,pivotY:n.pivotY,rotation:n.rotation}),y=new s(c,t,n),await j.shareObjects("parent",[y]),i.coreExtensionModule&&await u(i.coreExtensionModule,c),y.id}else if(B("releaseTexture",i)){x(c);const t=c.txManager;x(t),t.removeTextureIdFromCache(i.textureDescId)}},onObjectShared(i){},onBeforeObjectForgotten(i){i instanceof s&&(i.parent=null,i.destroy())}});export{_ as __vite_legacy_guard};
//# sourceMappingURL=threadx-core-worker-d7a8144a.js.map
